# Feature Pack: marketing
# Standalone marketing with plans, expenses, vendors, and dashboards (optional project linking via feature flag)

name: marketing
title: Marketing
description: Standalone marketing with plans, expenses, vendors, and dashboards (optional project linking via feature flag)

# ─────────────────────────────────────────────────────────────────────────────
# ROUTES - Frontend page routes
# ─────────────────────────────────────────────────────────────────────────────
routes:
  - path: /marketing
    page: Dashboard
    roles: []
    authz: { entity: marketing, verb: read }
  - path: /marketing/plans
    page: EntityList
    params: { entityKey: marketing.plan }
    roles: []
    authz: { entity: plans, verb: read }
  - path: /marketing/plans/new
    page: EntityEdit
    params: { entityKey: marketing.plan }
    roles: []
    authz: { entity: plans, verb: write, require_create: true }
  - path: /marketing/plans/[id]
    page: EntityDetail
    params: { entityKey: marketing.plan }
    roles: []
    authz: { entity: plans, verb: read }
  - path: /marketing/plans/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.plan }
    roles: []
    authz: { entity: plans, verb: write }
  - path: /marketing/expenses
    page: EntityList
    params: { entityKey: marketing.expense }
    roles: []
    authz: { entity: expenses, verb: read }
  - path: /marketing/expenses/new
    page: EntityEdit
    params: { entityKey: marketing.expense }
    roles: []
    authz: { entity: expenses, verb: write, require_create: true }
  - path: /marketing/expenses/[id]
    page: EntityDetail
    params: { entityKey: marketing.expense }
    roles: []
    authz: { entity: expenses, verb: read }
  - path: /marketing/expenses/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.expense }
    roles: []
    authz: { entity: expenses, verb: write }
  - path: /marketing/vendors
    page: EntityList
    params: { entityKey: marketing.vendor }
    roles: []
    authz: { entity: vendors, verb: read }
  - path: /marketing/vendors/new
    page: EntityEdit
    params: { entityKey: marketing.vendor }
    roles: []
    authz: { entity: vendors, verb: write, require_create: true }
  - path: /marketing/vendors/[id]
    page: EntityDetail
    params: { entityKey: marketing.vendor }
    roles: []
    authz: { entity: vendors, verb: read }
  - path: /marketing/vendors/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.vendor }
    roles: []
    authz: { entity: vendors, verb: write }
  - path: /marketing/setup/plan-types
    page: EntityList
    params: { entityKey: marketing.planType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/plan-types/new
    page: EntityEdit
    params: { entityKey: marketing.planType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/plan-types/[id]
    page: EntityDetail
    params: { entityKey: marketing.planType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/plan-types/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.planType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/activity-types
    page: EntityList
    params: { entityKey: marketing.activityType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/activity-types/new
    page: EntityEdit
    params: { entityKey: marketing.activityType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/activity-types/[id]
    page: EntityDetail
    params: { entityKey: marketing.activityType }
    roles: [admin]
    default_roles_allow: [admin]
  - path: /marketing/setup/activity-types/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.activityType }
    roles: [admin]
    default_roles_allow: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# NAVIGATION - Sidebar/topbar items
# ─────────────────────────────────────────────────────────────────────────────
nav:
  - id: marketing
    label: Marketing
    path: /marketing
    icon: Package
    group: main
    weight: 100
    showWhen: authenticated
    children:
      - id: marketing-dashboard
        label: Dashboard
        path: /marketing
        icon: LayoutDashboard
        weight: 100
        showWhen: authenticated
      - id: marketing-plans
        label: Plans
        path: /marketing/plans
        icon: ClipboardList
        weight: 200
        showWhen: authenticated
      - id: marketing-expenses
        label: Expenses
        path: /marketing/expenses
        icon: Receipt
        weight: 300
        showWhen: authenticated
      - id: marketing-vendors
        label: Vendors
        path: /marketing/vendors
        icon: Store
        weight: 400
        showWhen: authenticated
      - id: marketing-setup
        label: Setup
        path: ""
        icon: Settings
        weight: 900
        showWhen: authenticated
        roles: [admin]
        children:
          - id: marketing-setup-plan-types
            label: Plan Types
            path: /marketing/setup/plan-types
            icon: Tag
            weight: 100
            showWhen: authenticated
            roles: [admin]
          - id: marketing-setup-activity-types
            label: Activity Types
            path: /marketing/setup/activity-types
            icon: List
            weight: 200
            showWhen: authenticated
            roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/marketing.ts
  exports:
    - marketingPlanTypes
    - marketingActivityTypes
    - marketingPlans
    - marketingVendors
    - marketingExpenses
    - marketingPlanTypeBudgets
    - marketingEntityLinks
    - MarketingPlanType
    - InsertMarketingPlanType
    - MarketingActivityType
    - InsertMarketingActivityType
    - MarketingPlan
    - InsertMarketingPlan
    - MarketingVendor
    - InsertMarketingVendor
    - MarketingExpense
    - InsertMarketingExpense
    - MarketingPlanTypeBudget
    - InsertMarketingPlanTypeBudget
    - MarketingEntityLink
    - InsertMarketingEntityLink

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES - Backend endpoints
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    - path: /api/marketing/summary
      methods: [GET]
      handler: "@hit/feature-pack-marketing/server/api/summary"
      description: "Marketing dashboard summary (month, YTD, breakdowns)"
    - path: /api/marketing/plans
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plans"
      description: "List plans (GET) or create plan (POST)"
    - path: /api/marketing/plans/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/plans-id"
      description: "Get, update, or delete a specific plan"
    - path: /api/marketing/plans/[id]/type-budgets
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plans-type-budgets"
      description: "List or upsert activity-type budgets for a plan"
    - path: /api/marketing/expenses
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/expenses"
      description: "List expenses (GET) or create expense (POST)"
    - path: /api/marketing/expenses/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/expenses-id"
      description: "Get, update, or delete a specific expense"
    - path: /api/marketing/vendors
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/vendors"
      description: "List vendors (GET) or create vendor (POST)"
    - path: /api/marketing/vendors/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/vendors-id"
      description: "Get, update, or delete a specific vendor"
    - path: /api/marketing/plan-types
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plan-types"
      description: "List plan types (GET) or create plan type (POST) [admin]"
    - path: /api/marketing/plan-types/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/plan-types-id"
      description: "Get, update, or delete a plan type [admin]"
    - path: /api/marketing/activity-types
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/activity-types"
      description: "List activity types (GET) or create activity type (POST) [admin]"
    - path: /api/marketing/activity-types/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/activity-types-id"
      description: "Get, update, or delete an activity type [admin]"
    - path: /api/marketing/links
      methods: [GET, POST, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/links"
      description: "Optional entity linking (gated behind enable_project_linking)"

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Entity+Verb permissions model
# ─────────────────────────────────────────────────────────────────────────────
permissions:
  actions:
    # Scope Policy Tree: Marketing (global) -> entity overrides.
    #
    # Scope modes:
    # - none: deny all access for this verb/entity (hide pages + block APIs)
    # - all: ignore scope (read everything)
    # - own: only owned records (based on createdBy for expenses, or plan's createdBy for plans)
    # - ldd: same as all (marketing entities don't have LDD fields)
    #
    # These are mutually exclusive per node; the Security Groups UI renders them as dropdowns.
    - key: marketing.read.scope.none
      label: "Marketing Read Scope = None"
      description: "Deny all marketing read access."
      default_enabled: false
    - key: marketing.read.scope.all
      label: "Marketing Read Scope = All"
      description: "Read all marketing entities regardless of ownership."
      default_enabled: false
    - key: marketing.read.scope.own
      label: "Marketing Read Scope = Own"
      description: "Read only marketing entities you created."
      default_enabled: false
    - key: marketing.read.scope.ldd
      label: "Marketing Read Scope = LDD"
      description: "Read marketing entities (same as all, since marketing has no LDD fields)."
      default_enabled: false

    - key: marketing.write.scope.none
      label: "Marketing Write Scope = None"
      description: "Deny all marketing write access."
      default_enabled: false
    - key: marketing.write.scope.all
      label: "Marketing Write Scope = All"
      description: "Edit marketing entities regardless of ownership."
      default_enabled: false
    - key: marketing.write.scope.own
      label: "Marketing Write Scope = Own"
      description: "Edit only marketing entities you created."
      default_enabled: false
    - key: marketing.write.scope.ldd
      label: "Marketing Write Scope = LDD"
      description: "Edit marketing entities (same as all, since marketing has no LDD fields)."
      default_enabled: false

    - key: marketing.delete.scope.none
      label: "Marketing Delete Scope = None"
      description: "Deny all marketing delete access."
      default_enabled: false
    - key: marketing.delete.scope.all
      label: "Marketing Delete Scope = All"
      description: "Delete marketing entities regardless of ownership."
      default_enabled: false
    - key: marketing.delete.scope.own
      label: "Marketing Delete Scope = Own"
      description: "Delete only marketing entities you created."
      default_enabled: false
    - key: marketing.delete.scope.ldd
      label: "Marketing Delete Scope = LDD"
      description: "Delete marketing entities (same as all, since marketing has no LDD fields)."
      default_enabled: false

    # Plans override
    - key: marketing.plans.read.scope.none
      label: "Marketing Plans Read Scope = None"
      description: "Deny all plan read access."
      default_enabled: false
    - key: marketing.plans.read.scope.all
      label: "Marketing Plans Read Scope = All"
      description: "Read plans regardless of ownership."
      default_enabled: false
    - key: marketing.plans.read.scope.own
      label: "Marketing Plans Read Scope = Own"
      description: "Read only plans you created."
      default_enabled: false
    - key: marketing.plans.read.scope.ldd
      label: "Marketing Plans Read Scope = LDD"
      description: "Read plans (same as all, since plans have no LDD fields)."
      default_enabled: false

    - key: marketing.plans.write.scope.none
      label: "Marketing Plans Write Scope = None"
      description: "Deny all plan write access."
      default_enabled: false
    - key: marketing.plans.write.scope.all
      label: "Marketing Plans Write Scope = All"
      description: "Edit plans regardless of ownership."
      default_enabled: false
    - key: marketing.plans.write.scope.own
      label: "Marketing Plans Write Scope = Own"
      description: "Edit only plans you created."
      default_enabled: false
    - key: marketing.plans.write.scope.ldd
      label: "Marketing Plans Write Scope = LDD"
      description: "Edit plans (same as all, since plans have no LDD fields)."
      default_enabled: false

    - key: marketing.plans.delete.scope.none
      label: "Marketing Plans Delete Scope = None"
      description: "Deny all plan delete access."
      default_enabled: false
    - key: marketing.plans.delete.scope.all
      label: "Marketing Plans Delete Scope = All"
      description: "Delete plans regardless of ownership."
      default_enabled: false
    - key: marketing.plans.delete.scope.own
      label: "Marketing Plans Delete Scope = Own"
      description: "Delete only plans you created."
      default_enabled: false
    - key: marketing.plans.delete.scope.ldd
      label: "Marketing Plans Delete Scope = LDD"
      description: "Delete plans (same as all, since plans have no LDD fields)."
      default_enabled: false

    - key: marketing.plans.create
      label: Create Plan
      description: "Create a new marketing plan."
      default_enabled: true

    # Expenses override
    - key: marketing.expenses.read.scope.none
      label: "Marketing Expenses Read Scope = None"
      description: "Deny all expense read access."
      default_enabled: false
    - key: marketing.expenses.read.scope.all
      label: "Marketing Expenses Read Scope = All"
      description: "Read expenses regardless of ownership."
      default_enabled: false
    - key: marketing.expenses.read.scope.own
      label: "Marketing Expenses Read Scope = Own"
      description: "Read only expenses you created."
      default_enabled: false
    - key: marketing.expenses.read.scope.ldd
      label: "Marketing Expenses Read Scope = LDD"
      description: "Read expenses (same as all, since expenses have no LDD fields)."
      default_enabled: false

    - key: marketing.expenses.write.scope.none
      label: "Marketing Expenses Write Scope = None"
      description: "Deny all expense write access."
      default_enabled: false
    - key: marketing.expenses.write.scope.all
      label: "Marketing Expenses Write Scope = All"
      description: "Edit expenses regardless of ownership."
      default_enabled: false
    - key: marketing.expenses.write.scope.own
      label: "Marketing Expenses Write Scope = Own"
      description: "Edit only expenses you created."
      default_enabled: false
    - key: marketing.expenses.write.scope.ldd
      label: "Marketing Expenses Write Scope = LDD"
      description: "Edit expenses (same as all, since expenses have no LDD fields)."
      default_enabled: false

    - key: marketing.expenses.delete.scope.none
      label: "Marketing Expenses Delete Scope = None"
      description: "Deny all expense delete access."
      default_enabled: false
    - key: marketing.expenses.delete.scope.all
      label: "Marketing Expenses Delete Scope = All"
      description: "Delete expenses regardless of ownership."
      default_enabled: false
    - key: marketing.expenses.delete.scope.own
      label: "Marketing Expenses Delete Scope = Own"
      description: "Delete only expenses you created."
      default_enabled: false
    - key: marketing.expenses.delete.scope.ldd
      label: "Marketing Expenses Delete Scope = LDD"
      description: "Delete expenses (same as all, since expenses have no LDD fields)."
      default_enabled: false

    - key: marketing.expenses.create
      label: Create Expense
      description: "Create a new marketing expense."
      default_enabled: true

    # Vendors override
    - key: marketing.vendors.read.scope.none
      label: "Marketing Vendors Read Scope = None"
      description: "Deny all vendor read access."
      default_enabled: false
    - key: marketing.vendors.read.scope.all
      label: "Marketing Vendors Read Scope = All"
      description: "Read vendors regardless of ownership."
      default_enabled: false
    - key: marketing.vendors.read.scope.own
      label: "Marketing Vendors Read Scope = Own"
      description: "Read only vendors you created."
      default_enabled: false
    - key: marketing.vendors.read.scope.ldd
      label: "Marketing Vendors Read Scope = LDD"
      description: "Read vendors (same as all, since vendors have no LDD fields)."
      default_enabled: false

    - key: marketing.vendors.write.scope.none
      label: "Marketing Vendors Write Scope = None"
      description: "Deny all vendor write access."
      default_enabled: false
    - key: marketing.vendors.write.scope.all
      label: "Marketing Vendors Write Scope = All"
      description: "Edit vendors regardless of ownership."
      default_enabled: false
    - key: marketing.vendors.write.scope.own
      label: "Marketing Vendors Write Scope = Own"
      description: "Edit only vendors you created."
      default_enabled: false
    - key: marketing.vendors.write.scope.ldd
      label: "Marketing Vendors Write Scope = LDD"
      description: "Edit vendors (same as all, since vendors have no LDD fields)."
      default_enabled: false

    - key: marketing.vendors.delete.scope.none
      label: "Marketing Vendors Delete Scope = None"
      description: "Deny all vendor delete access."
      default_enabled: false
    - key: marketing.vendors.delete.scope.all
      label: "Marketing Vendors Delete Scope = All"
      description: "Delete vendors regardless of ownership."
      default_enabled: false
    - key: marketing.vendors.delete.scope.own
      label: "Marketing Vendors Delete Scope = Own"
      description: "Delete only vendors you created."
      default_enabled: false
    - key: marketing.vendors.delete.scope.ldd
      label: "Marketing Vendors Delete Scope = LDD"
      description: "Delete vendors (same as all, since vendors have no LDD fields)."
      default_enabled: false

    - key: marketing.vendors.create
      label: Create Vendor
      description: "Create a new marketing vendor."
      default_enabled: true

# ─────────────────────────────────────────────────────────────────────────────
# DEPENDENCIES
# ─────────────────────────────────────────────────────────────────────────────
requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: erp-shell-core

# ─────────────────────────────────────────────────────────────────────────────
# CONFIGURATION OPTIONS
# ─────────────────────────────────────────────────────────────────────────────
config:
  schema:
    enable_project_linking:
      type: boolean
      default: false
      description: "Enable optional project linking UI + APIs. Marketing remains standalone; links are never required."
    require_project_linking:
      type: boolean
      default: false
      description: "When project linking is enabled, require a project to be selected for plans/expenses."