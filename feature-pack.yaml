# Feature Pack: marketing
# Standalone marketing with plans, expenses, vendors, and dashboards (optional project linking via feature flag)

name: marketing
title: Marketing
description: Standalone marketing with plans, expenses, vendors, and dashboards (optional project linking via feature flag)

# ─────────────────────────────────────────────────────────────────────────────
# ROUTES - Frontend page routes
# ─────────────────────────────────────────────────────────────────────────────
routes:
  - path: /marketing
    page: EntityList
    params: { entityKey: marketing.plan }
  - path: /marketing/plans
    page: EntityList
    params: { entityKey: marketing.plan }
  - path: /marketing/plans/new
    page: EntityEdit
    params: { entityKey: marketing.plan }
  - path: /marketing/plans/[id]
    page: EntityDetail
    params: { entityKey: marketing.plan }
  - path: /marketing/plans/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.plan }
  - path: /marketing/expenses
    page: EntityList
    params: { entityKey: marketing.expense }
  - path: /marketing/expenses/new
    page: EntityEdit
    params: { entityKey: marketing.expense }
  - path: /marketing/expenses/[id]
    page: EntityDetail
    params: { entityKey: marketing.expense }
  - path: /marketing/expenses/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.expense }
  - path: /marketing/vendors
    page: EntityList
    params: { entityKey: marketing.vendor }
  - path: /marketing/vendors/new
    page: EntityEdit
    params: { entityKey: marketing.vendor }
  - path: /marketing/vendors/[id]
    page: EntityDetail
    params: { entityKey: marketing.vendor }
  - path: /marketing/vendors/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.vendor }
  - path: /marketing/setup/plan-types
    page: EntityList
    params: { entityKey: marketing.planType }
  - path: /marketing/setup/plan-types/new
    page: EntityEdit
    params: { entityKey: marketing.planType }
  - path: /marketing/setup/plan-types/[id]
    page: EntityDetail
    params: { entityKey: marketing.planType }
  - path: /marketing/setup/plan-types/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.planType }
  - path: /marketing/setup/activity-types
    page: EntityList
    params: { entityKey: marketing.activityType }
  - path: /marketing/setup/activity-types/new
    page: EntityEdit
    params: { entityKey: marketing.activityType }
  - path: /marketing/setup/activity-types/[id]
    page: EntityDetail
    params: { entityKey: marketing.activityType }
  - path: /marketing/setup/activity-types/[id]/edit
    page: EntityEdit
    params: { entityKey: marketing.activityType }

# ─────────────────────────────────────────────────────────────────────────────
# NAVIGATION - Sidebar/topbar items
# ─────────────────────────────────────────────────────────────────────────────
nav:
  - id: marketing
    label: Marketing
    path: /marketing
    icon: Package
    group: main
    weight: 100
    showWhen: authenticated
    children:
      - id: marketing-dashboard
        label: Dashboard
        path: /marketing
        icon: LayoutDashboard
        weight: 100
        showWhen: authenticated
      - id: marketing-plans
        label: Plans
        path: /marketing/plans
        icon: ClipboardList
        weight: 200
        showWhen: authenticated
      - id: marketing-expenses
        label: Expenses
        path: /marketing/expenses
        icon: Receipt
        weight: 300
        showWhen: authenticated
      - id: marketing-vendors
        label: Vendors
        path: /marketing/vendors
        icon: Store
        weight: 400
        showWhen: authenticated
      - id: marketing-setup
        label: Setup
        path: ""
        icon: Settings
        weight: 900
        showWhen: authenticated
        roles: [admin]
        children:
          - id: marketing-setup-plan-types
            label: Plan Types
            path: /marketing/setup/plan-types
            icon: Tag
            weight: 100
            showWhen: authenticated
            roles: [admin]
          - id: marketing-setup-activity-types
            label: Activity Types
            path: /marketing/setup/activity-types
            icon: List
            weight: 200
            showWhen: authenticated
            roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/marketing.ts
  exports:
    - marketingPlanTypes
    - marketingActivityTypes
    - marketingPlans
    - marketingVendors
    - marketingExpenses
    - marketingPlanTypeBudgets
    - marketingEntityLinks
    - MarketingPlanType
    - InsertMarketingPlanType
    - MarketingActivityType
    - InsertMarketingActivityType
    - MarketingPlan
    - InsertMarketingPlan
    - MarketingVendor
    - InsertMarketingVendor
    - MarketingExpense
    - InsertMarketingExpense
    - MarketingPlanTypeBudget
    - InsertMarketingPlanTypeBudget
    - MarketingEntityLink
    - InsertMarketingEntityLink
    - DEFAULT_MARKETING_PLAN_TYPES
    - DEFAULT_MARKETING_ACTIVITY_TYPES

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES - Backend endpoints
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    - path: /api/marketing/summary
      methods: [GET]
      handler: "@hit/feature-pack-marketing/server/api/summary"
      description: "Marketing dashboard summary (month, YTD, breakdowns)"
    # Setup entities - use pack-owned handlers so we can ensure defaults are seeded when empty.
    - path: /api/marketing/plan-types
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plan-types"
      description: "List plan types (GET) or create a plan type (POST)"
    - path: /api/marketing/plan-types/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/plan-types-id"
      description: "Get/update/delete a plan type"
    - path: /api/marketing/activity-types
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/activity-types"
      description: "List activity types (GET) or create an activity type (POST)"
    - path: /api/marketing/activity-types/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/activity-types-id"
      description: "Get/update/delete an activity type"
    - path: /api/marketing/plans
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plans"
      description: "List plans (GET) or create plan (POST)"
    - path: /api/marketing/plans/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/plans-id"
      description: "Get, update, or delete a specific plan"
    - path: /api/marketing/plans/[id]/type-budgets
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/plans-type-budgets"
      description: "List or upsert activity-type budgets for a plan"
    - path: /api/marketing/expenses
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/expenses"
      description: "List expenses (GET) or create expense (POST)"
    - path: /api/marketing/expenses/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/expenses-id"
      description: "Get, update, or delete a specific expense"
    - path: /api/marketing/vendors
      methods: [GET, POST]
      handler: "@hit/feature-pack-marketing/server/api/vendors"
      description: "List vendors (GET) or create vendor (POST)"
    - path: /api/marketing/vendors/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/vendors-id"
      description: "Get, update, or delete a specific vendor"
    - path: /api/marketing/links
      methods: [GET, POST, DELETE]
      handler: "@hit/feature-pack-marketing/server/api/links"
      description: "Optional entity linking (gated behind enable_project_linking)"

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Entity+Verb permissions model
# ─────────────────────────────────────────────────────────────────────────────
# Permissions are schema-driven and live under:
#   schema/permissions.yaml

# ─────────────────────────────────────────────────────────────────────────────
# DEPENDENCIES
# ─────────────────────────────────────────────────────────────────────────────
requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: erp-shell-core

# ─────────────────────────────────────────────────────────────────────────────
# CONFIGURATION OPTIONS
# ─────────────────────────────────────────────────────────────────────────────
config:
  schema:
    enable_project_linking:
      type: boolean
      default: false
      description: "Enable optional project linking UI + APIs. Marketing remains standalone; links are never required."
    require_project_linking:
      type: boolean
      default: false
      description: "When project linking is enabled, require a project to be selected for plans/expenses."